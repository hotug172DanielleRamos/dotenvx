const t = require('tap')
const nock = require('nock')
const packageJson = require('../../../src/lib/helpers/packageJson')

const LatestVersion = require('../../../src/lib/helpers/latestVersion')

t.test('#run', async ct => {
  const mockResp = {
    name: '@dotenvx/dotenvx',
    version: packageJson.version
  }

  nock('https://registry.npmjs.org')
    .get('/@dotenvx/dotenvx/latest')
    .reply(200, mockResp)

  const latestVersion = await new LatestVersion().run()

  ct.same(latestVersion, packageJson.version)

  ct.end()
})

t.test('#run 404', async ct => {
  const mockResp = {
    name: '@dotenvx/dotenvx',
    version: packageJson.version
  }

  nock('https://registry.npmjs.org')
    .get('/@dotenvx/dotenvx/latest')
    .reply(404, mockResp)

  const latestVersion = await new LatestVersion().run()

  ct.same(latestVersion, packageJson.version)

  ct.end()
})
